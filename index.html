<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Elastic Data Loader (es-data-load)</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/fontawesome.min.css" rel="stylesheet">
        <link href="css/brands.min.css" rel="stylesheet">
        <link href="css/solid.min.css" rel="stylesheet">
        <link href="css/v4-font-face.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">Elastic Data Loader (es-data-load)</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="." class="nav-link active" aria-current="page">Elastic Data Loader</a>
                            </li>
                            <li class="nav-item">
                                <a href="01%20-%20usage/" class="nav-link">Step-by-Step Usage Examples</a>
                            </li>
                            <li class="nav-item">
                                <a href="02%20-%20patentsview/" class="nav-link">Data load for PatentsView Search Platform</a>
                            </li>
                            <li class="nav-item">
                                <a href="03%20-%20API%20Reference/" class="nav-link">API Reference</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Reference</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">es_data_load</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="reference/es_data_load/DataSources/" class="dropdown-item">DataSources</a>
</li>
            
<li>
    <a href="reference/es_data_load/es/" class="dropdown-item">es</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">lib</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="reference/es_data_load/lib/utilities/" class="dropdown-item">utilities</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">pv</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">mappings</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="reference/es_data_load/pv/mappings/PVMappingsManager/" class="dropdown-item">PVMappingsManager</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">production</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="reference/es_data_load/pv/mappings/production/granted/" class="dropdown-item">granted</a>
</li>
            
<li>
    <a href="reference/es_data_load/pv/mappings/production/pregrant/" class="dropdown-item">pregrant</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="reference/es_data_load/pv/mappings/staging/" class="dropdown-item">staging</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">schemas</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="reference/es_data_load/pv/schemas/PVSchemaManager/" class="dropdown-item">PVSchemaManager</a>
</li>
            
<li>
    <a href="reference/es_data_load/pv/schemas/granted/" class="dropdown-item">granted</a>
</li>
            
<li>
    <a href="reference/es_data_load/pv/schemas/pregrant/" class="dropdown-item">pregrant</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">schema</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="reference/es_data_load/schema/SchemaManager/" class="dropdown-item">SchemaManager</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="reference/es_data_load/specification/" class="dropdown-item">specification</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                            <li class="nav-item">
                                <a rel="prev" class="nav-link disabled">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="01%20-%20usage/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#elastic-data-loader" class="nav-link">Elastic Data Loader</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#installation" class="nav-link">Installation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#getting-started" class="nav-link">Getting started</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#concepts" class="nav-link">Concepts</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-elasticsearch-index" class="nav-link">1. Elasticsearch Index</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-tabular-data-source" class="nav-link">2. Tabular Data Source</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-mapping" class="nav-link">3. Mapping</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#specifications" class="nav-link">Specifications</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#config-structure-for-elasticsearch-connection" class="nav-link">Config structure for elasticsearch connection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#config-structure-for-mysql-connection" class="nav-link">Config structure for MySQL Connection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#config-structure-for-delimited-connection" class="nav-link">Config structure for Delimited Connection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#json-structure-for-elasticsearch-index-creation" class="nav-link">JSON structure for elasticsearch index creation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#json-structure-for-mappings" class="nav-link">JSON structure for mappings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="elastic-data-loader">Elastic Data Loader<a class="headerlink" href="#elastic-data-loader" title="Permanent link">#</a></h1>
<p>Library for loading tabular data (typically from relational database tables) to elastic search index. Its goal is to
provide an interface through which PatentsView data can be loaded into elastic search index.</p>
<h1 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">#</a></h1>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>git+ssh://git@github.com/PatentsView/es-data-load.git
</span></code></pre></div>
<h1 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permanent link">#</a></h1>
<p>If you are attempting to load data for PatentsView Search Platform (API, etc.) you'll find code snippets in
the <a href="02%20-%20patentsview/">Data Load for PatentsView Search Platform</a> page.</p>
<p>If you'd like to see some usage examples proceed to <a href="01%20-%20usage/">General Usage Examples</a> page.</p>
<h1 id="concepts">Concepts<a class="headerlink" href="#concepts" title="Permanent link">#</a></h1>
<p>To effectively use this package, understanding of, and ability to create specifications for the following 3 concepts are
required.</p>
<h3 id="note-on-specifications">Note on specifications<a class="headerlink" href="#note-on-specifications" title="Permanent link">#</a></h3>
<p>Owing to its simplicity, JSON is used as the specification format. Given JSON's limitation pertaining to comments,
documentation on expected structure of all specification is provided in the <a href="#specifications">specifications</a> section.</p>
<h2 id="1-elasticsearch-index">1. Elasticsearch Index<a class="headerlink" href="#1-elasticsearch-index" title="Permanent link">#</a></h2>
<p>This corresponds to the "destination" of the data (also referred to as target elsewhere in this documentation).
See <a href="https://www.elastic.co/blog/what-is-an-elasticsearch-index">What is an elasticsearch index?</a>.</p>
<p>As it relates to an elastic search index, the following features are supported:</p>
<ul>
<li>Creating indices (drop and recreate if required)</li>
<li>Loading data into indices</li>
<li>Adding aliases</li>
</ul>
<p>See <a href="#usage">Usage</a> section for examples. See <a href="#json-structure-for-elasticsearch-index-creation">Specification</a> for JSON
structure</p>
<h2 id="2-tabular-data-source">2. Tabular Data Source<a class="headerlink" href="#2-tabular-data-source" title="Permanent link">#</a></h2>
<p>The next critical piece is the source data. Currently, this package supports only tabular data sources. Specifically,
delimited files and MySQL databases.</p>
<h3 id="21-delimited-data-source">2.1 Delimited Data Source<a class="headerlink" href="#21-delimited-data-source" title="Permanent link">#</a></h3>
<p>Formats such as CSV, TSV, etc. are supported. Quoting follows
pythons <a href="https://github.com/python/cpython/blob/38035fed9ba543d587c1fbba5c463d34edf3aff9/Lib/csv.py#L18">csv module</a>.</p>
<p><strong>N.B:</strong> Quote character is <code>"</code>. Customizing the <code>quotechar</code> is not supported.</p>
<h3 id="22-mysql-data-source">2.2 MySQL Data Source<a class="headerlink" href="#22-mysql-data-source" title="Permanent link">#</a></h3>
<p>Connecting to MySQL tables are views for data source is supported. The connection needs to specified
as <a href="https://pymysql.readthedocs.io/en/latest/index.html">PyMySQL</a> connection.</p>
<p><strong>N.B.</strong>: Internally, python primary data structures are used to optimize for performance (pandas dataframes for example
are not utilized). Due to this, sqlalchemy connection support is forgone.</p>
<h3 id="23-ini-specification">2.3 INI Specification<a class="headerlink" href="#23-ini-specification" title="Permanent link">#</a></h3>
<p>The specification for data source is optional. i.e. the delimited file properties or the mysql connection properties can
all be used directly when building the corresponding python objects. A convenience method is provided to
use <a href="https://docs.python.org/3/library/configparser.html">config</a> files. See <a href="#specifications">Specification</a> section.</p>
<h2 id="3-mapping">3. Mapping<a class="headerlink" href="#3-mapping" title="Permanent link">#</a></h2>
<p>Final piece of the puzzle is bridging the gap between data source(delimited/mysql) and data target(elastic search
index). The mapping allows for the means to collect data incrementally from the source, and load it into the index.
Features supported are:</p>
<ul>
<li>incremental data sourcing as well as incremental loading</li>
<li>upsert (update or insert) via key fields</li>
<li>load multiple data sources to targets at the same time</li>
</ul>
<h3 id="31-json-specification">3.1 JSON Specification<a class="headerlink" href="#31-json-specification" title="Permanent link">#</a></h3>
<p>The specification for the mapping allows for the following:</p>
<ul>
<li>Specify source SQL</li>
<li>Specify target index</li>
<li>Mapping between SQL select columns and elastic index field names</li>
<li>Specify key fields</li>
<li>Specify batch processing settings<ul>
<li>NB: If a chunksize is provided for batch processing, {offset} and {limit} placeholders must be provided in the source SQL to prevent an infinite loop.</li>
</ul>
</li>
</ul>
<h1 id="specifications">Specifications<a class="headerlink" href="#specifications" title="Permanent link">#</a></h1>
<h2 id="config-structure-for-elasticsearch-connection">Config structure for elasticsearch connection<a class="headerlink" href="#config-structure-for-elasticsearch-connection" title="Permanent link">#</a></h2>
<p><code>HOST</code> is required. Rest are optional</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">[ELASTICSEARCH]</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="na">HOST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">localhost:9200</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="na">USER</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="na">PASSWORD</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="na">TIMEOUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">120</span>
</span></code></pre></div>
<h2 id="config-structure-for-mysql-connection">Config structure for MySQL Connection<a class="headerlink" href="#config-structure-for-mysql-connection" title="Permanent link">#</a></h2>
<p><code>RETRIES</code> is optional. Rest are required</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">[DATABASE_SETUP]</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="na">HOST</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="na">PORT</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="na">USERNAME</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="na">PASSWORD</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="na">RETRIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>
</span></code></pre></div>
<h2 id="config-structure-for-delimited-connection">Config structure for Delimited Connection<a class="headerlink" href="#config-structure-for-delimited-connection" title="Permanent link">#</a></h2>
<p>Everything is required</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">[DELIMITED_SETUP]</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="na">TYPE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">delimited</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="na">DELIMITER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">tab</span>
</span></code></pre></div>
<h2 id="json-structure-for-elasticsearch-index-creation">JSON structure for elasticsearch index creation<a class="headerlink" href="#json-structure-for-elasticsearch-index-creation" title="Permanent link">#</a></h2>
<p>The JSON specification for creating an index using this package, follows elasticsearch's own specification for creating
an index.
See <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-create-index.html#mappings">Mappings</a> in
elasticsearch's documentation.</p>
<p><strong>N.B:</strong> Note that, only the value of the key "properties" from the above documentation is expected and supported.</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;field_name_1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;data_type&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="nt">&quot;field_name_2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nested&quot;</span><span class="p">,</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nt">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">      </span><span class="nt">&quot;subfield_name_1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;data_type&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="nt">&quot;field_name_3&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;data_type&quot;</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="json-structure-for-mappings">JSON structure for mappings<a class="headerlink" href="#json-structure-for-mappings" title="Permanent link">#</a></h2>
<p>The JSON for mapping has 2 components:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nt">&quot;source_setting&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nt">&quot;target_setting&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="sql-source-settings">SQL Source Settings<a class="headerlink" href="#sql-source-settings" title="Permanent link">#</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;select column1,column2, column3 from elastic_production_20230630.assignees where persistent_assignee_id &gt; &#39;{offset}&#39; order by persistent_assignee_id limit {limit};&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nt">&quot;field_mapping&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="nt">&quot;field_name_1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="nt">&quot;field_name_3&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">  </span><span class="nt">&quot;key_field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;field_name_3&quot;</span><span class="p">,</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">  </span><span class="nt">&quot;nested_fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nt">&quot;field_name_2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">      </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;select column_from_another_table from elastic_production_20230630.assignee_years ay join (select assignee_id, persistent_assignee_id from elastic_production_20230630.assignees where persistent_assignee_id &gt; &#39;{offset}&#39; order by persistent_assignee_id limit {limit}) a on a.assignee_id = ay.assignee_id&quot;</span><span class="p">,</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">      </span><span class="nt">&quot;field_mapping&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">        </span><span class="nt">&quot;subfield_name_1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">  </span><span class="nt">&quot;count_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT count(1) FROM elastic_production_20230630.assignees&quot;</span><span class="p">,</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">  </span><span class="nt">&quot;chunksize&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Data Type</th>
<th>Value Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>String</td>
<td>Templated SQL query that fetches records from source table. Must include limit/offset templated variable.</td>
<td>Up to the user to create query that makes sense. Typically achieved by using an id field to incrementally fetch subsequent records</td>
</tr>
<tr>
<td>field_mapping</td>
<td>JSON</td>
<td>JSON object providing positional mapping between selected columns and elasticsearch index fields</td>
<td>Keys should be elasticsearch index field names. Values should be numbers that positionally identify column from source</td>
</tr>
<tr>
<td>key_field</td>
<td>String</td>
<td>Elasticsearch field that identified each record uniquely (primary key)</td>
<td>See <code>id_field</code> below in <a href="#target-settings">Target Settings</a></td>
</tr>
<tr>
<td>nested_fields</td>
<td>JSON</td>
<td>JSON object that specifies the source_setting for nested elasticsearch field</td>
<td>All the rules listed in this table are recursively applied to nested_fields</td>
</tr>
<tr>
<td>count_source</td>
<td>String</td>
<td>SQL query that returns the number of records to be processed</td>
<td>Same rules about <code>source</code> field applies. First column of first row is used as count</td>
</tr>
<tr>
<td>chunksize</td>
<td>Numeric</td>
<td>Used as <code>limit</code> variable in <code>source</code> to iteratively fetch records</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="delimited-source-settings">Delimited Source Settings<a class="headerlink" href="#delimited-source-settings" title="Permanent link">#</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;source_setting&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tests/mappings/artifacts/g_us_patent_citations.sample.tsv&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nt">&quot;field_mapping&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">      </span><span class="nt">&quot;uuid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">      </span><span class="nt">&quot;patent_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">      </span><span class="nt">&quot;cited_patent_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">      </span><span class="nt">&quot;citation_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">      </span><span class="nt">&quot;citation_kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">      </span><span class="nt">&quot;citation_country&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">      </span><span class="nt">&quot;citation_category&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">      </span><span class="nt">&quot;citation_sequence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="nt">&quot;count_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tests/mappings/artifacts/g_us_patent_citations.sample.tsv&quot;</span><span class="p">,</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">    </span><span class="nt">&quot;key_field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="nt">&quot;chunksize&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>Rules are same as <a href="#sql-source-settings">SQL Source settings</a> with few exceptions:</p>
<ul>
<li><code>source</code> and <code>count_source</code> are just filepaths</li>
<li><code>chunksize</code> is ignored. Records are streamed from files</li>
</ul>
<h3 id="target-settings">Target Settings<a class="headerlink" href="#target-settings" title="Permanent link">#</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;assignees&quot;</span><span class="p">,</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="nt">&quot;indexing_batch_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7500</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nt">&quot;id_field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;assignee_id&quot;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">}</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value Data Type</th>
<th>Value Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>index</td>
<td>String</td>
<td>Index where data needs to be loaded</td>
<td>If index doesn't already exists, it'll be created with inferred data types. This is generally not preferable</td>
</tr>
<tr>
<td>indexing_batch_size</td>
<td>Numeric</td>
<td>Number of records to send in one batch when indexing</td>
<td></td>
</tr>
<tr>
<td>id_field</td>
<td>String</td>
<td>Elasticsearch index ID field</td>
<td>Should be same as <code>key_field</code> in <code>source_setting</code></td>
</tr>
</tbody>
</table></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.6.1
Build Date UTC : 2025-06-10 19:04:50.900720+00:00
-->
